{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import ReactMarkdown from'react-markdown';// Define baseURL dynamically\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const baseURL=(()=>{const{hostname}=window.location;if(hostname===\"127.0.0.1\"||hostname===\"localhost\"){return\"http://127.0.0.1:5000\";}else if(hostname.includes(\"johnnygardner.co.uk\")){return\"https://www.johnnygardner.co.uk\";}else{return\"https://noshly.onrender.com\";}})();const Dashboard=()=>{const[data,setData]=useState(null);const[mealPlan,setMealPlan]=useState(null);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const navigate=useNavigate();useEffect(()=>{const fetchDashboardData=async()=>{const token=localStorage.getItem(\"authToken\");if(!token){navigate(\"/login\");// Redirect to login if there's no token\nreturn;}try{const response=await fetch(\"\".concat(baseURL,\"/dashboard\"),{// Use baseURL dynamically\nheaders:{\"Authorization\":\"Bearer \".concat(token)// Send token in the request\n}});if(!response.ok){throw new Error(\"Unauthorized\");// If not authorized, handle the error\n}const result=await response.json();setData(result);}catch(error){setError(\"You are not authorized to access this page.\");navigate(\"/login\");// Redirect to login if there's an error (invalid token)\n}};fetchDashboardData();},[navigate]);const handleGenerateMealPlan=async()=>{setLoading(true);setMealPlan(null);setError(null);const token=localStorage.getItem(\"authToken\");if(!token){setError(\"You must be logged in to generate a meal plan.\");return;}try{const response=await fetch(\"\".concat(baseURL,\"/generateMealPlan\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(token)}});if(!response.ok){throw new Error(\"Failed to generate meal plan.\");}const result=await response.json();setMealPlan(result);}catch(error){setError(\"An error occurred while generating the meal plan.\");}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Dashboard\"}),error&&/*#__PURE__*/_jsx(\"p\",{style:{color:\"red\"},children:error}),/*#__PURE__*/_jsx(\"pre\",{children:JSON.stringify(data,null,2)}),/*#__PURE__*/_jsx(\"button\",{onClick:handleGenerateMealPlan,disabled:loading,children:loading?\"Generating...\":\"Generate Meal Plan\"}),mealPlan&&mealPlan.plan&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Generated Meal Plan\"}),/*#__PURE__*/_jsx(ReactMarkdown,{children:mealPlan.plan})]})]});};export default Dashboard;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","ReactMarkdown","jsx","_jsx","jsxs","_jsxs","baseURL","hostname","window","location","includes","Dashboard","data","setData","mealPlan","setMealPlan","loading","setLoading","error","setError","navigate","fetchDashboardData","token","localStorage","getItem","response","fetch","concat","headers","ok","Error","result","json","handleGenerateMealPlan","method","Authorization","children","style","color","JSON","stringify","onClick","disabled","plan"],"sources":["C:/Users/johnn/Documents/Noshly/frontend/src/pages/Dashboard.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport ReactMarkdown from 'react-markdown';\r\n\r\n// Define baseURL dynamically\r\nconst baseURL = (() => {\r\n  const { hostname } = window.location;\r\n  if (hostname === \"127.0.0.1\" || hostname === \"localhost\") {\r\n    return \"http://127.0.0.1:5000\";\r\n  } else if (hostname.includes(\"johnnygardner.co.uk\")) {\r\n    return \"https://www.johnnygardner.co.uk\";\r\n  } else {\r\n    return \"https://noshly.onrender.com\";\r\n  }\r\n})();\r\n\r\nconst Dashboard = () => {\r\n  const [data, setData] = useState(null);\r\n  const [mealPlan, setMealPlan] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    const fetchDashboardData = async () => {\r\n      const token = localStorage.getItem(\"authToken\");\r\n\r\n      if (!token) {\r\n        navigate(\"/login\");  // Redirect to login if there's no token\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const response = await fetch(`${baseURL}/dashboard`, {  // Use baseURL dynamically\r\n          headers: {\r\n            \"Authorization\": `Bearer ${token}`, // Send token in the request\r\n          },\r\n        });\r\n\r\n        if (!response.ok) {\r\n          throw new Error(\"Unauthorized\"); // If not authorized, handle the error\r\n        }\r\n\r\n        const result = await response.json();\r\n        setData(result);\r\n      } catch (error) {\r\n        setError(\"You are not authorized to access this page.\");\r\n        navigate(\"/login\");  // Redirect to login if there's an error (invalid token)\r\n      }\r\n    };\r\n\r\n    fetchDashboardData();\r\n  }, [navigate]);\r\n\r\n  const handleGenerateMealPlan = async () => {\r\n    setLoading(true);\r\n    setMealPlan(null);\r\n    setError(null);\r\n\r\n    const token = localStorage.getItem(\"authToken\");\r\n    if (!token) {\r\n      setError(\"You must be logged in to generate a meal plan.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`${baseURL}/generateMealPlan`, {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(\"Failed to generate meal plan.\");\r\n      }\r\n\r\n      const result = await response.json();\r\n      setMealPlan(result);\r\n    } catch (error) {\r\n      setError(\"An error occurred while generating the meal plan.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n      <div>\r\n        <h1>Dashboard</h1>\r\n        {error && <p style={{color: \"red\"}}>{error}</p>}\r\n\r\n        {/* Display Dashboard Data */}\r\n        <pre>{JSON.stringify(data, null, 2)}</pre>\r\n\r\n        {/* Generate Meal Plan Button */}\r\n        <button onClick={handleGenerateMealPlan} disabled={loading}>\r\n          {loading ? \"Generating...\" : \"Generate Meal Plan\"}\r\n        </button>\r\n\r\n        {/* Display Meal Plan */}\r\n        {mealPlan && mealPlan.plan && (\r\n            <div>\r\n              <h2>Generated Meal Plan</h2>\r\n              {/* Render meal plan content using ReactMarkdown */}\r\n              <ReactMarkdown>{mealPlan.plan}</ReactMarkdown>\r\n            </div>\r\n        )}\r\n      </div>\r\n  );\r\n};\r\n\r\nexport default Dashboard;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}